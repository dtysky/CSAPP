# 计算机系统漫游

## 编译系统

### 步骤

一次编译分为以下步骤：  

>1. 预处理器cpp：根据#开头的命令修改和注入代码，处理完的代码一般为“.i”文件。  
2. 编译器ccl：将“.i”文件翻译成文本“.s”文件，里面是汇编代码。  
3. 汇编器as：将汇编代码翻译成机器语言，保存在“.o”文件中。  
4. 连接器：将某些预编译好的代码合并到目标程序中，比如标准库中的一些函数，最终得到可执行文件。

### CNU项目

GNU's Not Unix。  
开发出一个完整的类unix系统，内核是linux。包括EMACS、GCC、GDB、汇编器、连接器等等，GCC支持许多种编译型语言。  

## 系统硬件

### 构成

CPU、存储器（磁盘存储器算外设）和外设构成，现代中一般是CPU和存储器中由存储器总线连接，和外设则是IO总线，还有加速计算的GPU等。  

一个简单的CPU的例子，使用Verilog编写：  

[SIMPLE_MIPS_CPU](https://github.com/dtysky/SIMPLE_MIPS_CPU)  

## 运行开销

比如运行一个简单的打印字符串的程序，加载时，复制到主存（SDRAM），运行时，主存复制到CPU的寄存器堆中，显示时，又复制到显示设备，这些“复制”就是主要开销之一。  

### 高速缓存

高速缓存是为了解决“复制”开销而构造的，它们由SRAM构成，容量介于寄存器堆和主存之间，速度也介于寄存器堆和主存之间。  

一般来讲，会有一个CPU片上的L1缓存，容量高于寄存器堆但访问速度等同于寄存器堆，但速度高于主存两个数量级；L2缓存容量高于L1缓存，速度为L1的五分之一；一些系统拥有L3缓存。  

高速缓存中会存放一些经常会使用到的指令，合理提高cache的命中率将会有效提高性能。（大概现在还有必要？）  

## 操作系统

操作系统隔离了上层应用和底层硬件，它提供两个功能：  

>1. 防止硬件被失控的应用程序滥用。
2. 向应用程序提供简单一致的机制来控制复杂而多样的硬件设备。

简而言之，OS通过自身高度的复杂度对上层应用提供了简单而良好的抽象，使得程序员不需要关心乱七八糟的兼容问题，使得分工和高效率成为了可能。  

这些抽象基本包括：  

>1. 文件：对IO设备的抽象。
2. 虚拟存储器：对主存和IO设备的抽象。  
3. 进程：对IO设备、主存和CPU的抽象。

### 进程

进程是操作系统对一个正在运行的程序的一种抽象。一个系统可以运行多个进程。  
但本质上，一个CPU在同一个时刻只能执行一个进程，多进程的假象（或者说也并不完全是假象）是通过实现的